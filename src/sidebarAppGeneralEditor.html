<script>

   function buildGeneralEditor(index, table_type) {
      var form =
      `
  <form>
    <div class="form-group">
      <div class="checkbox">
         <label><input type="checkbox" id="enabled_${table_type}_${index}">Enabled</label>
      </div>
    </div>
    <div class="form-group">
      <label>Query Bar</label>
      <select class="input-small form-control" id="querybar_${table_type}_${index}">
        <option value='none'>Disabled</option>
        <option value='top'>Top</option>
        <option value='bottom'>Bottom</option>
      </select>
    </div>
    <div class="form-group">
      <label>Headers</label>
      <select class="input-small form-control" id="headers_${table_type}_${index}">
        <option value='top'>Top</option>
        <option value='none'>Disabled</option>
        <option value='bottom'>Bottom</option>
      </select>
    </div>
    <div class="form-group">
      <label>Pagination</label>
      <select class="input-small form-control" id="pagination_${table_type}_${index}">
        <option value='bottom'>Bottom</option>
        <option value='none'>Disabled</option>
        <option value='top'>Top</option>
      </select>
    </div>
    <div class="form-group">
      <label>Status Info</label>
      <select class="input-small form-control" id="status_${table_type}_${index}">
        <option value='top'>Top</option>
        <option value='bottom'>Bottom</option>
        <option value='none'>Disabled</option>
      </select>
      <div class="checkbox">
         <label><input type="checkbox" id="status_merge_${table_type}_${index}">Merge with query/pagination rows</label>
      </div>
    </div>
    <!-- TODO: add back when supported -->
    <!--
    <div class="form-group">
      <label>Borders</label>
      <select class="input-small form-control" id="borders_${table_type}_${index}">
        <option value='none'>None</option>
        <option value='thin'>Thin</option>
      </select>
    </div>
    -->
    <!-- TODO: add back when supported -->
    <!--
    <div class="form-group">
      <label>Table Customization</label>
      <div class="input-group">
        <div class="input-group-addon for-rows-and-cols">
          <span class="input-group-text">Skip rows</span>
       </div>
       <input type="text" class="form-control" placeholder="Row offsets to skip" value="" id="skip_rows_${table_type}_${index}">
      </div>
      <div class="input-group">
        <div class="input-group-addon for-rows-and-cols">
          <span class="input-group-text">Skip columns</span>
       </div>
       <input type="text" class="form-control" placeholder="Column offsets to skip" value="" id="skip_cols_${table_type}_${index}">
      </div>
     </div>
     -->
  </form>
      `

      return form
   }

   /** Called from the table types' "populate", populates the common model from the JSON */
   function populateGeneralEditor(index, name, json, table_type) {

      // Globally enabled:
      var globalEnable = json.enabled || true
      $(`#enabled_${table_type}_${index}`).prop('checked', globalEnable)

      // Query bar
      var querySource = getJson(json, ["common", "query", "source"]) || "none"
      if (querySource == "none") {
         $(`#querybar_${table_type}_${index}`).val("none")
      } else {
         var localQueryPos = getJson(json, ["common", "query", "local", "position"]) || "none"
         $(`#querybar_${table_type}_${index}`).val(localQueryPos)
      }

      // Headers
      var headersPos = getJson(json, ["common", "headers", "position"]) || "none"
      $(`#headers_${table_type}_${index}`).val(headersPos)

      // Pagination
      var paginationSource = getJson(json, ["common", "pagination", "source"]) || "none"
      if (paginationSource == "none") {
         $(`#pagination_${table_type}_${index}`).val("none")
      } else {
         var localPaginationPos = getJson(json, ["common", "pagination", "local", "position"]) || "none"
         $(`#pagination_${table_type}_${index}`).val(localPaginationPos)
      }

      // Status
      var statusPos = getJson(json, ["common", "status", "position"]) || "none"
      $(`#status_${table_type}_${index}`).val(statusPos)
      var statusMerge = getJson(json, ["common", "status", "merge"]) || true
      $(`#status_merge_${table_type}_${index}`).prop('checked', statusMerge)

      // Borders
      var borderStyle = getJson(json, ["common", "borders", "style"]) || "none"
      $(`#borders_${table_type}_${index}`).val(borderStyle)

      // Skip rows/cols
      var skipRows = getJson(json, ["common", "skip", "rows"]) || ""
      $(`#skip_rows_${table_type}_${index}`).val(skipRows)
      var skipCols = getJson(json, ["common", "skip", "cols"]) || ""
      $(`#skip_cols_${table_type}_${index}`).val(skipCols)
  }

   /** Called from the table types' "register", Adds event handlers to all the common elements */
   function registerGeneralEditor(index, name, json, curr_editor, table_type) {
      // Globally enabled:
      $(`#enabled_${table_type}_${index}`).change(function() {
         var thisChecked = this.checked
         updateRawJson(curr_editor, function(currJson) {
            currJson.enabled = thisChecked
         })
      })
      // Query bar
      $(`#querybar_${table_type}_${index}`).change(function() {
         var thisValue = this.value
         updateRawJson(curr_editor, function(currJson) {
            var query = getOrPutJsonObj(currJson, [ "common", "query" ])
            query.source = (thisValue == "none") ? "none" : "local" // (only supported option currently)
            var localQuery = getOrPutJsonObj(currJson, [ "common", "query", "local" ])
            localQuery.position = thisValue
         })
      })
      // Headers
      $(`#headers_${table_type}_${index}`).change(function() {
         var thisValue = this.value
         updateRawJson(curr_editor, function(currJson) {
            var headers = getOrPutJsonObj(currJson, [ "common", "headers" ])
            headers.position = thisValue
         })
      })
      // Pagination
      $(`#pagination_${table_type}_${index}`).change(function() {
         var thisValue = this.value
         updateRawJson(curr_editor, function(currJson) {
            var pagination = getOrPutJsonObj(currJson, [ "common", "pagination" ])
            pagination.source = (thisValue == "none") ? "none" : "local" // (only supported option currently)
            var localPagination = getOrPutJsonObj(currJson, [ "common", "pagination", "local" ])
            localPagination.position = thisValue
         })
      })
      // Status
      $(`#status_${table_type}_${index}`).change(function() {
         var thisValue = this.value
         updateRawJson(curr_editor, function(currJson) {
            var status = getOrPutJsonObj(currJson, [ "common", "status" ])
            status.position = thisValue
         })
      })
      $(`#status_merge_${table_type}_${index}`).change(function() {
         var thisChecked = this.checked
         updateRawJson(curr_editor, function(currJson) {
            var status = getOrPutJsonObj(currJson, [ "common", "status" ])
            status.merge = thisChecked
         })
      })
      // Borders
      //TODO: put back when supported
      /*
      $(`#borders_${table_type}_${index}`).change(function() {
         var thisValue = this.value
         updateRawJson(curr_editor, function(currJson) {
            var borders = getOrPutJsonObj(currJson, [ "common", "borders" ])
            borders.style = thisValue
         })
      })
      */
      // Skip rows/cols
      //TODO: put back when supported
      /*
      $(`#skip_rows_${table_type}_${index}`).on("input", function(e) {
         var thisValue = this.value
         updateRawJson(curr_editor, function(currJson) {
            var skip = getOrPutJsonObj(currJson, [ "common", "skip" ])
            skip.rows = thisValue
         })
      })
      $(`#skip_cols_${table_type}_${index}`).on("input", function(e) {
         var thisValue = this.value
         updateRawJson(curr_editor, function(currJson) {
            var skip = getOrPutJsonObj(currJson, [ "common", "skip" ])
            skip.cols = thisValue
         })
      })
      */
   }

</script>
